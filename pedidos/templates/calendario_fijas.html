<!DOCTYPE html>
<html lang="es">
{% extends 'base.html' %}
{% block content %}
{% load static %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/locales-all.global.min.js"></script>
</head>

<body class="bg-gray-50">
  <div class="max-w-7xl mx-auto bg-white p-10 mt-12 shadow-2xl rounded-2xl border border-gray-200 animate-fade-in">
    <!-- TÃ­tulo -->
    <div class="mb-6 bg-gradient-to-r from-gray-800 to-gray-900 p-5 rounded-xl text-center shadow-md">
      <h2 class="text-3xl font-extrabold text-white tracking-tight">ðŸ“… Calendario de Ubicaciones Fijas</h2>
    </div>

    <!-- Filtros -->
    <div class="mb-6 flex flex-col sm:flex-row gap-4 items-center justify-center">
      <label for="select-ubicacion" class="font-semibold text-gray-700">UbicaciÃ³n:</label>
      <select id="select-ubicacion"
        class="border border-gray-300 rounded-lg p-2 shadow-sm focus:ring-2 focus:ring-gray-800 focus:border-gray-800 transition">
        <option value="">â€” Seleccione â€”</option>
        {% for u in listado_ubicaciones %}
        <option value="{{ u.id }}">{{ u.codigo }} â€” {{ u.direccion }}</option>
        {% endfor %}
      </select>
    </div>


    <!-- Calendario -->
    <div id="calendario" class="rounded-xl border border-gray-300 shadow-lg overflow-hidden"></div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const calendarEl = document.getElementById('calendario');
    const selectUbi = document.getElementById('select-ubicacion');

    // ðŸ”¹ Bandera para saber si ya se seleccionÃ³ algo
    let ubicacionSeleccionada = false;

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      nowIndicator: true,
      navLinks: true,
      dayMaxEventRows: true,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,listWeek'
      },
      buttonText: {
        today: 'Hoy',
        month: 'Mes',
        week: 'Semana',
        day: 'DÃ­a',
        list: 'Lista'
      },
      // ðŸ”¹ Solo cargar eventos si hay ubicaciÃ³n seleccionada
      events: function (info, successCallback, failureCallback) {
        if (!ubicacionSeleccionada) {
          successCallback([]); // sin datos al inicio
          return;
        }

        const params = new URLSearchParams({
          start: info.startStr,
          end: info.endStr,
        });
        if (selectUbi.value) params.set('ubicacion_id', selectUbi.value);

        fetch(`/api/ocupaciones-fijas/?${params}`)
          .then(r => r.json())
          .then(data => successCallback(data))
          .catch(err => failureCallback(err));
      },
      eventClick: function (info) {
        const e = info.event.extendedProps;
        alert(`ðŸ“ ${e.direccion}\nðŸ§¾ Nota: ${e.nota_id}\nðŸ“† DÃ­as: ${e.dias}`);
      }
    });

    calendar.render();

    // ðŸ”¹ Al cambiar de ubicaciÃ³n, activar la carga
    selectUbi.addEventListener('change', () => {
      ubicacionSeleccionada = !!selectUbi.value; // true si hay algo seleccionado
      calendar.refetchEvents(); // recargar (o vaciar)
    });
  });
</script>

  <style>
    /* TransiciÃ³n de entrada */
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fade-in 0.6s ease-in-out;
    }

    /* Mejora del calendario */
    .fc {
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      background: #fff;
    }

    .fc-toolbar {
      background: linear-gradient(135deg, #1e293b, #0f172a);
      color: white;
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .fc-toolbar-title {
      font-weight: 700 !important;
      font-size: 1.3rem !important;
      color: white !important;
    }

    .fc-button {
      background-color: #3b82f6 !important;
      border: none !important;
      color: white !important;
      border-radius: 0.5rem !important;
      padding: 0.4rem 0.8rem !important;
      font-weight: 500 !important;
      transition: background 0.2s, transform 0.1s;
    }

    .fc-button:hover {
      background-color: #2563eb !important;
      transform: scale(1.05);
    }

    .fc-button-active {
      background-color: #1d4ed8 !important;
    }

    .fc-day-today {
      background-color: #e0f2fe !important;
    }

    .fc-event {
      border: none !important;
      border-radius: 0.5rem !important;
      font-size: 0.8rem;
      font-weight: 600;
      padding: 3px 6px;
      transition: transform 0.1s ease, box-shadow 0.2s ease;
    }

    .fc-event:hover {
      transform: scale(1.03);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }
  </style>
</body>
{% endblock %}

</html>